<!doctype html>
<html lang="ar" dir="rtl"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>ููุญุฉ ุงูููุงุฏุฉ | ุฃ. ุฃุญูุฏ ุนูุฏ</title> 
  <script src="https://cdn.tailwindcss.com"></script> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> 
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script> 
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script> 
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script> 
  <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #f8fafc; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .adm-tab { display: none; }
        .adm-tab.active { display: block; animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .tab-btn { transition: all 0.3s; opacity: 0.7; }
        .tab-btn.active { background-color: #0f172a; color: white; opacity: 1; transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input:focus, textarea:focus, select:focus { border-color: #10b981; outline: none; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1); }
        #toast-notification { transform: translateY(-150%); transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        #toast-notification.show { transform: translateY(0); }
    </style> 
 </head> 
 <body class="pb-20 text-slate-800"> 
  <div id="toast-notification" class="fixed top-5 left-1/2 -translate-x-1/2 z-[9999] flex items-center gap-3 px-6 py-4 rounded-2xl shadow-2xl text-white font-bold min-w-[300px] justify-center"> <i id="toast-icon" class="text-xl"></i> <span id="toast-msg"></span> 
  </div> 
  <nav class="bg-slate-900 text-white p-4 shadow-xl sticky top-0 z-50 border-b-4 border-emerald-500"> 
   <div class="container mx-auto flex justify-between items-center"> 
    <h1 class="text-xl font-black flex items-center gap-2"> <i class="fas fa-sliders-h text-emerald-400"></i> ููุญุฉ ุงูุฅุฏุงุฑุฉ </h1> <button onclick="app.logout()" class="hidden id-logout bg-red-600 hover:bg-red-700 text-white px-5 py-2 rounded-xl font-bold text-xs transition-all">ุฎุฑูุฌ</button> 
   </div> 
  </nav> 
  <div class="container mx-auto px-4 py-8"> 
   <div id="login-view" class="max-w-md mx-auto bg-white p-10 rounded-[2.5rem] shadow-2xl mt-12 text-center border-t-8 border-slate-900"> 
    <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-6"> <i class="fas fa-user-lock text-3xl text-slate-800"></i> 
    </div> 
    <h2 class="text-3xl font-black mb-8">ุชุณุฌูู ุฏุฎูู ุงููุฏูุฑ</h2> 
    <div class="space-y-4"> 
     <input type="email" id="adm-email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" class="w-full border-2 p-4 rounded-2xl font-bold"> 
     <input type="password" id="adm-pass" placeholder="ูููุฉ ุงููุฑูุฑ" class="w-full border-2 p-4 rounded-2xl font-bold"> <button onclick="app.login()" class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black shadow-lg hover:bg-black transition-all">ุฏุฎูู ุขูู</button> 
    </div> 
   </div> 
   <div id="panel-view" class="hidden space-y-8"> 
    <div class="flex gap-3 overflow-x-auto pb-4 no-scrollbar justify-center"> <button onclick="admin.switchTab('settings')" class="tab-btn active bg-white text-slate-600 px-6 py-3 rounded-2xl font-black text-sm whitespace-nowrap shadow">๐๏ธ ุงูุฅุนุฏุงุฏุงุช</button> <button onclick="admin.switchTab('create')" class="tab-btn bg-white text-slate-600 px-6 py-3 rounded-2xl font-black text-sm whitespace-nowrap shadow">๐ ุฅูุดุงุก ูุญุชูู</button> <button onclick="admin.switchTab('simulation')" class="tab-btn bg-white text-slate-600 px-6 py-3 rounded-2xl font-black text-sm whitespace-nowrap shadow border-2 border-yellow-200">โ๏ธ ุฅูุดุงุก ูุญุงูู</button> <button onclick="admin.switchTab('manage')" class="tab-btn bg-white text-slate-600 px-6 py-3 rounded-2xl font-black text-sm whitespace-nowrap shadow">๐๏ธ ุฅุฏุงุฑุฉ ูุชุนุฏูู</button> 
    </div> 
    <div id="tab-settings" class="adm-tab active block bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100"> 
     <h3 class="font-black text-xl mb-6 text-emerald-700 border-r-4 border-emerald-500 pr-3">ุฅุนุฏุงุฏุงุช ุงููุตูุต ูุงูุฑูุงุจุท</h3> 
     <div class="grid grid-cols-1 md:grid-cols-2 gap-6"> 
      <div class="bg-slate-50 p-5 rounded-3xl space-y-3"> 
       <h4 class="font-bold text-slate-800 mb-2">ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ</h4> 
       <div> <label class="text-[10px] font-bold text-slate-400">ุงุณู ุงูููุตุฉ:</label> 
        <input id="set-site-name" class="w-full border p-2 rounded-xl font-bold"> 
       </div> 
       <div> <label class="text-[10px] font-bold text-slate-400">ุงูุนููุงู ุงูุฑุฆูุณู (Hero):</label> 
        <input id="set-hero-title" class="w-full border p-2 rounded-xl font-bold"> 
       </div> 
       <div> <label class="text-[10px] font-bold text-slate-400">ุงููุตู:</label> 
        <input id="set-hero-desc" class="w-full border p-2 rounded-xl font-bold"> 
       </div> 
       <div> <label class="text-[10px] font-bold text-yellow-600">ููุฏ ุงููุดุชุฑููู (Password):</label> 
        <input id="set-access-code" class="w-full border p-2 rounded-xl bg-yellow-50 font-black text-center text-lg"> 
       </div> 
      </div> 
      <div class="bg-slate-50 p-5 rounded-3xl space-y-3"> 
       <h4 class="font-bold text-slate-800 mb-2">ุงูุฃุฒุฑุงุฑ ูุงูุชูุงุตู</h4> 
       <div> <label class="text-[10px] font-bold text-slate-400">ูุงุชุณุงุจ:</label> 
        <input id="set-whatsapp" class="w-full border p-2 rounded-xl font-bold"> 
       </div> 
       <div> <label class="text-[10px] font-bold text-slate-400">ูุต ุงูููุชุฑ:</label> 
        <input id="set-footer-text" class="w-full border p-2 rounded-xl font-bold"> 
       </div> 
       <div class="grid grid-cols-2 gap-2"> 
        <div> <label class="text-[10px] font-bold text-slate-400">ุฒุฑ ุงูุฒูุงุฑ:</label> 
         <input id="set-btn-visitor" class="w-full border p-2 rounded-xl font-bold"> 
        </div> 
        <div> <label class="text-[10px] font-bold text-slate-400">ุฒุฑ ุงููุดุชุฑููู:</label> 
         <input id="set-btn-sub" class="w-full border p-2 rounded-xl font-bold"> 
        </div> 
       </div> 
      </div> 
     </div> 
     <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6"> 
      <div class="bg-slate-800 p-5 rounded-3xl space-y-2 text-white"> 
       <h4 class="font-bold text-yellow-400">ุงูุฑุงุจุท ุงูุฎุงุฑุฌู</h4> 
       <input id="set-ext-link-url" placeholder="URL" class="w-full bg-slate-700 border-none p-2 rounded-xl text-xs"> 
       <input id="set-ext-link-text" placeholder="ุงููุต" class="w-full bg-slate-700 border-none p-2 rounded-xl text-xs"> 
      </div> 
      <div class="bg-blue-50 p-5 rounded-3xl space-y-2"> 
       <h4 class="font-bold text-blue-600">ุชุทุจูู ุงููุงุชู</h4> 
       <input id="set-app-link" placeholder="ุฑุงุจุท ุงูุชุญููู" class="w-full bg-white border p-2 rounded-xl text-xs"> 
       <input id="set-app-text" placeholder="ูุต ุงูุจูุฑ" class="w-full bg-white border p-2 rounded-xl text-xs"> 
      </div> 
     </div> 
     <div class="mt-6"> <label class="text-xs font-bold text-slate-400">ุชุนูููุงุช ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ:</label> <textarea id="set-tutorial" class="w-full border p-3 rounded-2xl h-24 font-bold bg-slate-50 text-slate-700"></textarea> 
     </div> <button onclick="admin.saveSettings()" class="w-full bg-emerald-600 text-white py-4 rounded-2xl mt-6 font-black shadow-lg hover:bg-emerald-700 transition-all">ุญูุธ ุงูุฅุนุฏุงุฏุงุช โ</button> 
    </div> 
    <div id="tab-create" class="adm-tab space-y-6"> 
     <div class="bg-white p-6 rounded-[2rem] shadow-sm border-r-8 border-blue-600"> 
      <h4 class="font-black text-lg mb-4 text-blue-800">1. ุฅูุดุงุก ุงุฎุชุจุงุฑ ุฌุฏูุฏ</h4> 
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4"> <select id="adm-mode" class="w-full border p-3 rounded-xl font-bold bg-slate-50"><option value="visitor">๐ ููุชูุญ</option><option value="subscriber">๐ ูููุดุชุฑููู</option></select> <select id="adm-major" class="w-full border p-3 rounded-xl font-bold bg-slate-50"> <option value="Universal">ุนุงู</option><option value="Competition">ูุณุงุจูุงุช</option> <option value="ูุบุฉ ุนุฑุจูุฉ">ูุบุฉ ุนุฑุจูุฉ</option><option value="ุฑูุงุถูุงุช">ุฑูุงุถูุงุช</option> <option value="ุนููู">ุนููู</option><option value="ุฏุฑุงุณุงุช">ุฏุฑุงุณุงุช</option><option value="ูุบุฉ ุฅูุฌููุฒูุฉ">English</option> </select> <select id="adm-minor" class="w-full border p-3 rounded-xl font-bold bg-slate-50"> <option value="ุชุฎุตุต">ุฃุณุฆูุฉ ุงูุชุฎุตุต</option><option value="ุชุฑุจูู">ุชุฑุจูู</option> <option value="ุฌุฏุงุฑุงุช">ุฌุฏุงุฑุงุช</option><option value="IQ">IQ</option> <option value="ุนุฑุจู ููุฌููุน">ุนุฑุจู ููุฌููุน</option><option value="ุงูุฌููุฒู ููุฌููุน">ุงูุฌููุฒู ููุฌููุน</option> <option value="ูุนูููุงุช ุนุงูุฉ">ูุนูููุงุช ุนุงูุฉ</option> </select> 
      </div> 
      <div class="flex gap-2"> 
       <input id="new-quiz-name" placeholder="ุงุณู ุงูุงุฎุชุจุงุฑ" class="flex-1 border-2 p-3 rounded-xl font-bold"> <button onclick="admin.addQuiz()" class="bg-blue-600 text-white px-6 rounded-xl font-black">ุฅูุดุงุก</button> 
      </div> 
     </div> 
     <div class="bg-white p-6 rounded-[2rem] shadow-sm border-r-8 border-purple-600"> 
      <h4 class="font-black text-lg mb-4 text-purple-800">2. ุฅุถุงูุฉ ุงูุฃุณุฆูุฉ</h4> <select id="adm-target-quiz" class="w-full border-2 p-3 rounded-xl font-bold bg-purple-50 mb-4"></select> 
      <div class="flex gap-2 mb-4"> <button onclick="document.getElementById('add-manual').classList.remove('hidden');document.getElementById('add-bulk').classList.add('hidden')" class="flex-1 bg-purple-600 text-white py-2 rounded-xl font-bold">ูุฏูู</button> <button onclick="document.getElementById('add-bulk').classList.remove('hidden');document.getElementById('add-manual').classList.add('hidden')" class="flex-1 bg-slate-200 text-slate-700 py-2 rounded-xl font-bold">ูุฌูุน (JSON)</button> 
      </div> 
      <div id="add-manual" class="space-y-3"> <textarea id="q-text" placeholder="ูุต ุงูุณุคุงู" class="w-full border p-3 rounded-xl h-20 font-bold"></textarea> 
       <div class="grid grid-cols-2 gap-2"> 
        <input id="opt1" placeholder="ุฃ" class="border p-2 rounded-lg font-bold"> 
        <input id="opt2" placeholder="ุจ" class="border p-2 rounded-lg font-bold"> 
        <input id="opt3" placeholder="ุฌ" class="border p-2 rounded-lg font-bold"> 
        <input id="opt4" placeholder="ุฏ" class="border p-2 rounded-lg font-bold"> 
       </div> 
       <input id="q-ans" placeholder="ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ" class="w-full border bg-emerald-50 p-3 rounded-xl font-bold text-center"> <button onclick="admin.addManualQ()" class="w-full bg-purple-600 text-white py-3 rounded-xl font-black">ุญูุธ ุงูุณุคุงู</button> 
      </div> 
      <div id="add-bulk" class="hidden space-y-3"> 
       <p class="text-[10px] font-bold text-slate-500">ุถุน ุงูุฃุณุฆูุฉ ุฏุงุฎู ูุตูููุฉ <code>[...]</code> ูุชุฃูุฏ ูู ุงูููุงุตู.</p> <textarea id="json-input" class="w-full bg-slate-900 text-green-400 font-mono p-4 rounded-xl h-32 text-xs" dir="ltr"></textarea> <button onclick="admin.processJSON()" class="w-full bg-slate-800 text-white py-3 rounded-xl font-black">ุงุณุชูุฑุงุฏ</button> 
      </div> 
     </div> 
     <div class="bg-white p-6 rounded-[2rem] shadow-sm border-r-8 border-red-600"> 
      <h4 class="font-black text-lg mb-4 text-red-700">3. ุฅุถุงูุฉ ูููุงุช</h4> 
      <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4"> <select id="file-mode" class="border p-3 rounded-xl font-bold"><option value="visitor">๐ ููุชูุญ</option><option value="subscriber">๐ ูููุดุชุฑููู</option></select> <select id="file-major" class="border p-3 rounded-xl font-bold"> <option value="Competition">ูุณุงุจูุงุช</option><option value="ูุบุฉ ุนุฑุจูุฉ">ูุบุฉ ุนุฑุจูุฉ</option> <option value="ุฑูุงุถูุงุช">ุฑูุงุถูุงุช</option><option value="ุนููู">ุนููู</option> <option value="ุฏุฑุงุณุงุช">ุฏุฑุงุณุงุช</option><option value="ูุบุฉ ุฅูุฌููุฒูุฉ">English</option> </select> <select id="file-minor" class="border p-3 rounded-xl font-bold"><option value="ูููุงุช">ูููุงุช ุงูุชุฎุตุต</option><option value="ุชุฑุจูู">ุชุฑุจูู</option></select> 
      </div> 
      <input id="file-name" placeholder="ุงุณู ุงูููู" class="w-full border p-3 rounded-xl font-bold mb-2"> 
      <input id="file-url" placeholder="ุงูุฑุงุจุท" class="w-full border p-3 rounded-xl font-bold mb-2 text-left" dir="ltr"> <button onclick="admin.addFile()" class="w-full bg-red-600 text-white py-3 rounded-xl font-black">ุญูุธ ุงูููู</button> 
     </div> 
    </div> 
    <div id="tab-simulation" class="adm-tab bg-white p-6 rounded-[2rem] shadow-sm border border-yellow-400"> 
     <h3 class="font-black text-xl mb-6 text-slate-800">โ๏ธ ุฅูุดุงุก ุงุฎุชุจุงุฑ ูุญุงูู ุฌุฏูุฏ</h3> 
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"> 
      <div> <label class="text-xs font-bold block">ุงุณู ุงููุญุงูุงุฉ</label> 
       <input id="new-sim-name" placeholder="ูุซูุงู: ุงููุญุงูู ุงูุฃูู" class="border p-2 w-full rounded-lg font-bold"> 
      </div> 
      <div> <label class="text-xs font-bold block">ุงูุญุงูุฉ</label><select id="new-sim-mode" class="border p-2 w-full rounded-lg font-bold"><option value="visitor">๐ ููุชูุญ</option><option value="subscriber">๐ ูููุดุชุฑููู</option></select> 
      </div> 
      <div> <label class="text-xs font-bold block text-blue-600">ุชุฎุตุต ุงููุญุงูู</label> <select id="new-sim-major" class="border p-2 w-full rounded-lg font-bold"> <option value="ูุบุฉ ุนุฑุจูุฉ">ูุบุฉ ุนุฑุจูุฉ</option> <option value="ุฑูุงุถูุงุช">ุฑูุงุถูุงุช</option> <option value="ุนููู">ุนููู</option> <option value="ุฏุฑุงุณุงุช">ุฏุฑุงุณุงุช</option> <option value="ูุบุฉ ุฅูุฌููุฒูุฉ">English</option> </select> 
      </div> 
     </div> 
     <p class="text-xs text-slate-500 font-bold mb-2">ุชูุฒูุน ุงูุฃุณุฆูุฉ:</p> 
     <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-6"> 
      <div> <label class="text-[10px] font-bold block text-blue-600">ุชุฎุตุต</label> 
       <input type="number" id="ns-spec" class="border p-2 w-full rounded-lg text-center" value="15"> 
      </div> 
      <div> <label class="text-[10px] font-bold block">ุชุฑุจูู</label> 
       <input type="number" id="ns-ped" class="border p-2 w-full rounded-lg text-center" value="10"> 
      </div> 
      <div> <label class="text-[10px] font-bold block">ุฌุฏุงุฑุงุช</label> 
       <input type="number" id="ns-comp" class="border p-2 w-full rounded-lg text-center" value="5"> 
      </div> 
      <div> <label class="text-[10px] font-bold block">IQ</label> 
       <input type="number" id="ns-iq" class="border p-2 w-full rounded-lg text-center" value="5"> 
      </div> 
      <div> <label class="text-[10px] font-bold block">ุนุฑุจู</label> 
       <input type="number" id="ns-ar" class="border p-2 w-full rounded-lg text-center" value="5"> 
      </div> 
      <div> <label class="text-[10px] font-bold block">ุฅูุฌููุฒู</label> 
       <input type="number" id="ns-en" class="border p-2 w-full rounded-lg text-center" value="5"> 
      </div> 
      <div> <label class="text-[10px] font-bold block">ูุนูููุงุช</label> 
       <input type="number" id="ns-gen" class="border p-2 w-full rounded-lg text-center" value="5"> 
      </div> 
      <div> <label class="text-[10px] font-bold block text-red-500">ุงูููุช (ุฏ)</label> 
       <input type="number" id="ns-time" class="border p-2 w-full rounded-lg text-center bg-red-50" value="60"> 
      </div> 
     </div> <button onclick="admin.createSimulation()" class="w-full bg-slate-900 text-white py-4 rounded-xl font-black">ุฅุถุงูุฉ ุงููุญุงูู</button> 
    </div> 
    <div id="tab-manage" class="adm-tab bg-white p-6 rounded-[2rem] shadow-sm"> 
     <div class="flex justify-between items-center mb-6 pb-4 border-b"> 
      <h3 class="font-black text-xl text-slate-800">ุฅุฏุงุฑุฉ ุงููุญุชูู ุงููุงููุฉ</h3> <button onclick="admin.nuke()" class="text-red-500 font-bold border border-red-200 px-3 py-1 rounded-xl text-xs hover:bg-red-50">ุญุฐู ุงููุตูุน โ๏ธ</button> 
     </div> 
     <div id="admin-tree" class="space-y-4"></div> 
    </div> 
   </div> 
  </div> 
  <div id="edit-q-modal" class="fixed inset-0 bg-slate-900/95 hidden z-[100] flex items-center justify-center p-4 backdrop-blur-sm"> 
   <div class="bg-white p-8 rounded-[2rem] w-full max-w-lg space-y-4 shadow-2xl"> 
    <h3 class="font-black text-xl text-center">ุชุนุฏูู ุงูุณุคุงู</h3> 
    <input type="hidden" id="edit-qid"> 
    <input type="hidden" id="edit-idx"> <textarea id="eq-text" class="w-full border p-4 rounded-xl h-28 font-bold text-lg"></textarea> 
    <div class="grid grid-cols-2 gap-3"> 
     <input id="eq-o0" class="border p-3 rounded-lg font-bold"> 
     <input id="eq-o1" class="border p-3 rounded-lg font-bold"> 
     <input id="eq-o2" class="border p-3 rounded-lg font-bold"> 
     <input id="eq-o3" class="border p-3 rounded-lg font-bold"> 
    </div> 
    <div class="flex items-center gap-2"> <label class="text-xs font-bold whitespace-nowrap">ุฑูู ุงูุฅุฌุงุจุฉ (0-3):</label> 
     <input id="eq-ans" type="number" class="w-20 border p-2 rounded-lg text-center font-bold"> 
    </div> 
    <div class="flex gap-2 pt-4"> <button onclick="admin.saveQuestionEdit()" class="flex-1 bg-emerald-600 text-white py-3 rounded-xl font-black shadow">ุญูุธ</button> <button onclick="document.getElementById('edit-q-modal').classList.add('hidden')" class="flex-1 bg-slate-100 text-slate-500 py-3 rounded-xl font-bold">ุฅูุบุงุก</button> 
    </div> 
   </div> 
  </div> 
  <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDvFOWeYV2grWux_Z-nl3uFiTR2Jd9UlvE",
            authDomain: "tgrep-11831.firebaseapp.com",
            databaseURL: "https://tgrep-11831-default-rtdb.firebaseio.com",
            projectId: "tgrep-11831",
            storageBucket: "tgrep-11831.firebasestorage.app",
            messagingSenderId: "129365723816",
            appId: "1:129365723816:web:be1fb88079c9a38ac2d09d"
        };
        firebase.initializeApp(firebaseConfig);
        const dbRef = firebase.database().ref('edu_platform_data');
        let db = { quizzes: [], files: [], simulations: [], settings: {} };

        const app = {
            login: () => {
                const e = document.getElementById('adm-email').value, p = document.getElementById('adm-pass').value;
                if(!e||!p) return app.notify("ุงูุจูุงูุงุช ูุงูุตุฉ", "error");
                firebase.auth().signInWithEmailAndPassword(e,p).then(()=>location.reload()).catch(err=>app.notify(err.message, "error"));
            },
            logout: () => firebase.auth().signOut().then(()=>location.reload()),
            notify: (msg, type='success') => {
                const t = document.getElementById('toast-notification');
                const i = document.getElementById('toast-icon');
                const m = document.getElementById('toast-msg');
                t.className = `fixed top-5 left-1/2 -translate-x-1/2 z-[9999] flex items-center gap-3 px-6 py-4 rounded-2xl shadow-2xl text-white font-bold min-w-[300px] justify-center transition-all duration-300 ${type==='error'?'bg-red-600':'bg-emerald-600'}`;
                i.className = type==='error' ? 'fas fa-exclamation-circle' : 'fas fa-check-circle';
                m.innerText = msg;
                t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 3000);
            },
            init: () => {
                firebase.auth().onAuthStateChanged(user => {
                    if(user) {
                        document.getElementById('login-view').classList.add('hidden');
                        document.getElementById('panel-view').classList.remove('hidden');
                        document.querySelector('.id-logout').classList.remove('hidden');
                        dbRef.on('value', snap => {
                            if(snap.val()) db = snap.val();
                            admin.loadSettings();
                            admin.updateDropdowns();
                            admin.renderTree();
                        });
                    }
                });
            }
        };

        const admin = {
            switchTab: (t) => {
                document.querySelectorAll('.adm-tab').forEach(e=>e.classList.remove('active'));
                document.getElementById('tab-'+t).classList.add('active');
                document.querySelectorAll('.tab-btn').forEach(e=>e.classList.remove('active'));
                event.target.classList.add('active');
            },
            loadSettings: () => {
                const s = db.settings || {};
                const ids = ['set-site-name', 'set-hero-title', 'set-hero-desc', 'set-whatsapp', 'set-access-code', 'set-footer-text', 'set-tutorial', 'set-ext-link-url', 'set-ext-link-text', 'set-app-link', 'set-app-text', 'set-btn-visitor', 'set-btn-sub'];
                ids.forEach(id => { 
                    const k = id.replace('set-','').replace(/-./g, x=>x[1].toUpperCase());
                    if(id === 'set-tutorial' && s.tutorialText) document.getElementById(id).value = s.tutorialText;
                    else if(document.getElementById(id)) document.getElementById(id).value = s[k] || ""; 
                });
            },
            saveSettings: () => {
                const s = {};
                ['siteName','heroTitle','heroDesc','whatsapp','accessCode','footerText','tutorialText','extLinkUrl','extLinkText','appLink','appText','btnVisitor','btnSub'].forEach(k => {
                    let id = 'set-' + k.replace(/[A-Z]/g, x => '-' + x.toLowerCase());
                    if(k === 'tutorialText') id = 'set-tutorial';
                    s[k] = document.getElementById(id).value;
                });
                db.settings = s; admin.save(); app.notify("ุชู ุงูุญูุธ ุจูุฌุงุญ");
            },
            addQuiz: () => {
                const n = document.getElementById('new-quiz-name').value;
                if(!n) return app.notify("ุงูุงุณู ูุทููุจ", "error");
                if(!db.quizzes) db.quizzes = [];
                db.quizzes.push({
                    id: Date.now(), name: n,
                    mode: document.getElementById('adm-mode').value,
                    major: document.getElementById('adm-major').value,
                    minor: document.getElementById('adm-minor').value,
                    questions: []
                });
                admin.save(); app.notify("ุชู ุฅุถุงูุฉ ุงูุงุฎุชุจุงุฑ");
            },
            addManualQ: () => {
                const qid = document.getElementById('adm-target-quiz').value;
                const q = db.quizzes.find(x=>x.id==qid);
                if(!q) return app.notify("ุงุฎุชุฑ ุงุฎุชุจุงุฑ", "error");
                if(!q.questions) q.questions = [];
                q.questions.push({
                    text: document.getElementById('q-text').value,
                    opts: [1,2,3,4].map(i=>document.getElementById('opt'+i).value),
                    correctAnswer: [1,2,3,4].map(i=>document.getElementById('opt'+i).value).indexOf(document.getElementById('q-ans').value)
                });
                admin.save(); app.notify("ุชู ุฅุถุงูุฉ ุงูุณุคุงู");
            },
            processJSON: () => {
                try {
                    let val = document.getElementById('json-input').value.trim();
                    if(!val.startsWith('[') && val.startsWith('{')) val = `[${val}]`; 
                    const data = JSON.parse(val);
                    const qid = document.getElementById('adm-target-quiz').value;
                    const q = db.quizzes.find(x=>x.id==qid);
                    if(!q.questions) q.questions = [];
                    (Array.isArray(data)?data:[data]).forEach(i => q.questions.push({text:i.question, opts:i.options, correctAnswer:i.correctAnswer}));
                    admin.save(); app.notify("ุชู ุงูุงุณุชูุฑุงุฏ ุจูุฌุงุญ");
                } catch(e) { app.notify("ุชุฃูุฏ ูู ุตูุบุฉ ุงูููู (JSON Array)", "error"); }
            },
            addFile: () => {
                if(!db.files) db.files = [];
                db.files.push({
                    id: Date.now(), name: document.getElementById('file-name').value,
                    url: document.getElementById('file-url').value,
                    mode: document.getElementById('file-mode').value,
                    major: document.getElementById('file-major').value,
                    minor: document.getElementById('file-minor').value
                });
                admin.save(); app.notify("ุชู ุฅุถุงูุฉ ุงูููู");
            },
            createSimulation: () => {
                const name = document.getElementById('new-sim-name').value;
                if(!name) return app.notify("ุงุณู ุงููุญุงูู ูุทููุจ", "error");
                if(!db.simulations) db.simulations = [];
                db.simulations.push({
                    id: Date.now(),
                    name: name,
                    mode: document.getElementById('new-sim-mode').value,
                    targetMajor: document.getElementById('new-sim-major').value, // ุญูุธ ุงูุชุฎุตุต ุงููุฎุชุงุฑ
                    time: parseInt(document.getElementById('ns-time').value) || 60,
                    counts: {
                        spec: parseInt(document.getElementById('ns-spec').value)||0,
                        ped: parseInt(document.getElementById('ns-ped').value)||0,
                        comp: parseInt(document.getElementById('ns-comp').value)||0,
                        iq: parseInt(document.getElementById('ns-iq').value)||0,
                        ar: parseInt(document.getElementById('ns-ar').value)||0,
                        en: parseInt(document.getElementById('ns-en').value)||0,
                        gen: parseInt(document.getElementById('ns-gen').value)||0
                    }
                });
                admin.save(); app.notify("ุชู ุฅูุดุงุก ุงููุญุงูู");
            },
            renderTree: () => {
                const t = document.getElementById('admin-tree'); t.innerHTML = "";
                
                if(db.simulations && db.simulations.length) {
                    t.innerHTML += `<h4 class="font-bold text-slate-800 border-b pb-2 mb-2">โก ุงููุญุงููุงุช:</h4>`;
                    db.simulations.forEach(s => {
                        const locked = s.mode === 'subscriber';
                        t.innerHTML += `
                        <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200 mb-2 flex justify-between items-center">
                            <div>
                                <span class="text-xs font-bold ${locked?'text-red-500':'text-green-500'}">[ ${locked?'ูุบูู':'ููุชูุญ'} ]</span> 
                                <span class="font-bold">${s.name}</span>
                                <span class="text-xs text-blue-600 font-bold mx-2">(${s.targetMajor || 'ุนุงู'})</span>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="admin.toggleLock('sim', ${s.id})" class="text-xs bg-white px-2 py-1 rounded border hover:bg-slate-100">${locked?'๐ ูุชุญ':'๐ ููู'}</button>
                                <button onclick="admin.delItem('sim', ${s.id})" class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded border border-red-200 hover:bg-red-200">ุญุฐู</button>
                            </div>
                        </div>`;
                    });
                }
                
                t.innerHTML += `<h4 class="font-bold text-slate-800 border-b pb-2 mb-2 mt-4">๐ ุงูุงุฎุชุจุงุฑุงุช:</h4>`;
                (db.quizzes || []).forEach(q => {
                    const locked = q.mode === 'subscriber';
                    t.innerHTML += `
                    <div class="bg-white p-4 rounded-xl border mb-2 shadow-sm">
                        <div class="flex flex-col md:flex-row justify-between items-center gap-2">
                            <div class="flex items-center gap-2">
                                <span class="text-[10px] font-bold ${locked?'bg-red-100 text-red-600':'bg-green-100 text-green-600'} px-2 py-1 rounded-lg">${locked?'ูุบูู':'ููุชูุญ'}</span>
                                <h5 class="font-bold text-slate-800">${q.name} <span class="text-xs text-slate-400">(${q.major} > ${q.minor})</span></h5>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="admin.toggleQs(${q.id})" class="text-xs bg-blue-50 text-blue-600 px-3 py-2 rounded-lg font-bold border border-blue-100 hover:bg-blue-100">ุงูุฃุณุฆูุฉ (${q.questions?.length||0})</button>
                                <button onclick="admin.toggleLock('quiz', ${q.id})" class="text-xs bg-slate-100 text-slate-600 px-3 py-2 rounded-lg font-bold hover:bg-slate-200">${locked?'๐ ูุชุญ':'๐ ููู'}</button>
                                <button onclick="admin.delItem('quiz', ${q.id})" class="text-xs bg-red-50 text-red-600 px-3 py-2 rounded-lg font-bold hover:bg-red-100">ุญุฐู</button>
                            </div>
                        </div>
                        <div id="qs-${q.id}" class="hidden mt-4 pt-4 border-t space-y-2 bg-slate-50 p-2 rounded-lg">
                            ${(q.questions||[]).map((sq, i) => `
                                <div class="flex justify-between items-center bg-white p-2 rounded border border-slate-100 shadow-sm">
                                    <span class="text-xs font-bold text-slate-600 truncate w-3/4">${i+1}. ${sq.text}</span>
                                    <div class="flex gap-1">
                                        <button onclick="admin.editQ(${q.id}, ${i})" class="text-xs text-emerald-500 p-1 hover:bg-emerald-50 rounded"><i class="fas fa-edit"></i></button>
                                        <button onclick="admin.delQ(${q.id}, ${i})" class="text-xs text-red-500 p-1 hover:bg-red-50 rounded"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>`;
                });

                if(db.files && db.files.length) {
                    t.innerHTML += `<h4 class="font-bold text-red-600 border-b pb-2 mb-2 mt-4">๐ ุงููููุงุช:</h4>`;
                    db.files.forEach(f => {
                        const locked = f.mode === 'subscriber';
                        t.innerHTML += `
                        <div class="bg-white p-4 rounded-xl border-r-4 border-red-400 mb-2 flex justify-between items-center shadow-sm">
                            <div>
                                <span class="text-[10px] ${locked?'text-red-500':'text-green-500'} font-bold">[${locked?'ูุบูู':'ููุชูุญ'}]</span>
                                <span class="font-bold text-sm">${f.name}</span> <span class="text-xs text-slate-400">(${f.major})</span>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="admin.toggleLock('file', ${f.id})" class="text-xs bg-slate-100 px-2 py-1 rounded hover:bg-slate-200">${locked?'๐':'๐'}</button>
                                <button onclick="admin.delItem('file', ${f.id})" class="text-xs bg-red-50 text-red-500 px-2 py-1 rounded hover:bg-red-100">ุญุฐู</button>
                            </div>
                        </div>`;
                    });
                }
            },
            toggleQs: (id) => document.getElementById('qs-'+id).classList.toggle('hidden'),
            toggleLock: (type, id) => {
                let list = type==='quiz'?db.quizzes : type==='file'?db.files : db.simulations;
                let item = list.find(x=>x.id===id);
                item.mode = item.mode==='visitor'?'subscriber':'visitor';
                admin.save();
            },
            editQ: (qid, idx) => {
                const q = db.quizzes.find(x=>x.id==qid).questions[idx];
                document.getElementById('edit-qid').value = qid; document.getElementById('edit-idx').value = idx;
                document.getElementById('eq-text').value = q.text;
                [0,1,2,3].forEach(i => document.getElementById('eq-o'+i).value = q.opts[i]);
                document.getElementById('eq-ans').value = q.correctAnswer;
                document.getElementById('edit-q-modal').classList.remove('hidden');
            },
            saveQuestionEdit: () => {
                const qid = document.getElementById('edit-qid').value;
                const idx = document.getElementById('edit-idx').value;
                const q = db.quizzes.find(x=>x.id==qid);
                q.questions[idx] = {
                    text: document.getElementById('eq-text').value,
                    opts: [0,1,2,3].map(i=>document.getElementById('eq-o'+i).value),
                    correctAnswer: parseInt(document.getElementById('eq-ans').value)
                };
                admin.save();
                document.getElementById('edit-q-modal').classList.add('hidden');
                app.notify("ุชู ุงูุชุนุฏูู");
            },
            delItem: (type, id) => {
                if(!confirm("ุชุฃููุฏ ุงูุญุฐูุ")) return;
                if(type==='quiz') db.quizzes = db.quizzes.filter(x=>x.id!=id);
                else if(type==='file') db.files = db.files.filter(x=>x.id!=id);
                else db.simulations = db.simulations.filter(x=>x.id!=id);
                admin.save();
            },
            delQ: (qid, idx) => {
                if(!confirm("ุญุฐู ุงูุณุคุงู ููุงุฆูุงูุ")) return;
                const q = db.quizzes.find(x=>x.id==qid);
                q.questions.splice(idx, 1);
                admin.save();
            },
            updateDropdowns: () => document.getElementById('adm-target-quiz').innerHTML = (db.quizzes||[]).map(q=>`<option value="${q.id}">[${q.major}] ${q.name}</option>`).join(''),
            nuke: () => { if(confirm("ุชุญุฐูุฑ: ูุฐุง ุณูุญุฐู ูู ุดูุก!")) { db={quizzes:[],files:[],simulations:[],settings:db.settings}; admin.save(); } },
            save: () => dbRef.set(db)
        };
        app.init();
    </script> 
 
</body></html>